scale_fill_manual(values = palette5,
labels = qBr(allTracts.group, "TotalPop"),
name = "Median Rent\n(Quintile Breaks)") + mapTheme() +
facet_wrap(~year)+
geom_sf(data = allTracts.group %>%
filter(TOD == "TOD") %>%
st_union(),
color = "red",
fill = "transparent")+
labs(
title = "Median Rent in 2020 adjusted Dollars, 2016-2020",
subtitle = "",
caption = "Figure Number, Data: US Census Bureau, ACS 5-year estimates",
fill = "Median Rent")
#plotting med inc
ggplot()+
geom_sf(data = allTracts.group, aes(fill = q5(MedInc)), color="transparent")+
scale_fill_manual(values = palette5,
labels = qBr(allTracts.group, "MedInc"),
name = "Median Income\n(Quintile Breaks)") + mapTheme() +
facet_wrap(~year)+
geom_sf(data = allTracts.group %>%
filter(TOD == "TOD") %>%
st_union(),
color = "red",
fill = "transparent")+
labs(
title = "Median Income in 2020 adjusted Dollars, 2016-2020",
subtitle = "",
caption = "Figure Number, Data: US Census Bureau, ACS 5-year estimates",
fill = "Median Income")
#plotting med rent
ggplot()+
geom_sf(data = allTracts.group, aes(fill = q5(MedRent)), color="transparent")+
scale_fill_manual(values = palette5,
labels = qBr(allTracts.group, "MedRent"),
name = "Median Rent\n(Quintile Breaks)") + mapTheme() +
facet_wrap(~year)+
geom_sf(data = allTracts.group %>%
filter(TOD == "TOD") %>%
st_union(),
color = "red",
fill = "transparent")+
labs(
title = "Median Rent in 2020 adjusted Dollars, 2016-2020",
subtitle = "",
caption = "Figure Number, Data: US Census Bureau, ACS 5-year estimates",
fill = "Median Rent")
#plotting BusArtSciences
ggplot()+
geom_sf(data = allTracts.group, aes(fill = q5(BusArtsScience)),color="transparent")+
scale_fill_manual(values = palette5,
labels = qBr(allTracts.group, "TotalPop"),
name = "Number of Residents\n(Quintile Breaks)") + mapTheme() +
facet_wrap(~year)+
geom_sf(data = allTracts.group %>%
filter(TOD == "TOD") %>%
st_union(),
color = "red",
fill = "transparent")+
labs(
title = "People Employed in the Business, Arts or Sciences Sector, 2016-2020",
subtitle = "",
caption = "Figure Number, Data: US Census Bureau, ACS 5-year estimates",
fill = "Population")
install.packages("prettydoc")
library(prettydoc)
knitr::opts_chunk$set(
echo = TRUE,
warning = FALSE,
message = FALSE,
out.width = '100%',
fig.retina =3
)
# Load Libraries
library(tidyverse)
library(tidycensus)
library(sf)
library(kableExtra)
library(tidyr)
library(ggplot2)
library(viridis)
library(prettydoc)
options(scipen=999)
options(tigris_class = "sf")
#these are functions developed for this class, so it takes you especially to the book to get those
source("https://raw.githubusercontent.com/urbanSpatial/Public-Policy-Analytics-Landing/master/functions.r")
palette5 <- c("#fde725","#5ec962","#21918c","#3b528b","#440154")
census_api_key('bf2d507651b5a621dbadd44533fb4f3deaab26bf', overwrite = TRUE)
dir.create("output")
acs_variable_list.2020 <- load_variables(2020, #year
"acs5", #five year ACS estimates
cache = TRUE)
acs_variable_list.2016 <- load_variables(2016, #year
"acs5", #five year ACS estimates
cache = TRUE)
tracts16 <-
get_acs(geography = "tract",
variables = c("B25026_001E",#pop
"B19013_001E", #med inc
"B25058_001E", #rent
"B24011_002E" ), #ppl in business science arts
year=2016,
state = 25,
county=025, #using the boston/suffolk county FIPS code
geometry=TRUE) %>%
st_transform('ESRI:102728')
# making it wide from long
tracts16 <-
tracts16 %>%
dplyr::select( -NAME, -moe) %>%
spread(key = variable, value = estimate) %>% #spread makes it long to wide
rename(TotalPop = B25026_001,
MedInc = B19013_001,
MedRent = B25058_001,
BusArtsScience = B24011_002)
#creating new variable
tracts16 <-
tracts16 %>%
mutate(IncSpentOnRentPCt = ifelse(MedInc > 0, MedRent / MedInc, 0),
year = "2016")
#doing the same thing for 2020
tracts20 <-
get_acs(geography = "tract",
variables = c("B25026_001E",#pop
"B19013_001E", #med inc
"B25058_001E", #rent
"B24011_002E" ), #ppl in business science arts
year=2020,
state = 25,
county=025, #using the boston/suffolk county FIPS code
geometry=TRUE, output="wide")%>%
st_transform('ESRI:102728') %>%
rename(TotalPop = B25026_001E,
MedInc = B19013_001E,
MedRent = B25058_001E,
BusArtsScience = B24011_002E)%>%
dplyr::select(-NAME, -ends_with("M")) %>%
mutate(IncSpentOnRentPCt = ifelse(MedInc > 0, MedRent / MedInc, 0),
year = "2020")
#binding the data
allTracts <- rbind(tracts16,tracts20)
github_url <-"https://raw.githubusercontent.com/samriddhikhar3/Assignment2/main/data/MBTA_Systemwide_GTFS_Map.geojson"
MBTAStops <- st_read(github_url) %>%
st_transform(st_crs(tracts16))
#clipping to tracts boundaries
clippedMBTA <-
st_intersection(MBTAStops, tracts16)
#plotting
ggplot() +
geom_sf(data=st_union(tracts16)) +
geom_sf(data=clippedMBTA) +
labs(title="MBTA Stops",
subtitle="Boston, MA",
caption="Figure 1.1") +
mapTheme()
#creating a buffer
MBTABuffers <-
rbind(
st_buffer(clippedMBTA, 2640) %>%
mutate(Legend = "Buffer") %>%
dplyr::select(Legend),
st_union(st_buffer(clippedMBTA, 2640)) %>% #the number at the end is in feet, because our CRS is in feet
st_sf() %>%
mutate(Legend = "Unioned Buffer")) #all st functions will be spatial related stuff
ggplot() +
geom_sf(data=MBTABuffers) +
geom_sf(data=clippedMBTA, show.legend = "point") +
facet_wrap(~Legend) +
labs(caption = "Figure 1.2") +
mapTheme()
#just the buffers
buffer <- filter(MBTABuffers, Legend=="Unioned Buffer")
#selecting the TOD tracts
selectCentroids <-
st_centroid(tracts16)[buffer,] %>%
st_drop_geometry() %>%
left_join(., dplyr::select(tracts16, GEOID), by = "GEOID") %>%
st_sf() %>%
dplyr::select(TotalPop) %>%
mutate(Selection_Type = "Select by Centroids")
ggplot() +
geom_sf(data=selectCentroids, aes(fill = TotalPop)) +
geom_sf(data=clippedMBTA, show.legend = "point") +
scale_fill_viridis_c() +
facet_wrap(~Selection_Type) +
mapTheme()
#comparing TOD vs non TOD indicators
allTracts.group <-
rbind(
st_centroid(allTracts)[buffer,] %>%
st_drop_geometry() %>%
left_join(allTracts) %>%
st_sf() %>%
mutate(TOD = "TOD"),
st_centroid(allTracts)[buffer, op = st_disjoint] %>%
st_drop_geometry() %>%
left_join(allTracts) %>%
st_sf() %>%
mutate(TOD = "Non-TOD")) %>%
mutate(MedRent.inf = ifelse(year == "2016", MedRent * 1.10, MedRent))
#plotting total pop
ggplot()+
geom_sf(data = allTracts.group, aes(fill = q5(TotalPop)), color="transparent")+
scale_fill_manual(values = palette5,
labels = qBr(allTracts.group, "TotalPop"),
name = "Popluation\n(Quintile Breaks)") + mapTheme() +
facet_wrap(~year)+
geom_sf(data = allTracts.group %>%
filter(TOD == "TOD") %>%
st_union(),
color = "red",
fill = "transparent")+
labs(
title = "Total Population, 2016-2020",
subtitle = "",
caption = "Figure Number, Data: US Census Bureau, ACS 5-year estimates",
fill = "Total Population")
#plotting med inc
ggplot()+
geom_sf(data = allTracts.group, aes(fill = q5(MedInc)), color="transparent")+
scale_fill_manual(values = palette5,
labels = qBr(allTracts.group, "MedInc"),
name = "Median Income\n(Quintile Breaks)") + mapTheme() +
facet_wrap(~year)+
geom_sf(data = allTracts.group %>%
filter(TOD == "TOD") %>%
st_union(),
color = "red",
fill = "transparent")+
labs(
title = "Median Income in 2020 adjusted Dollars, 2016-2020",
subtitle = "",
caption = "Figure Number, Data: US Census Bureau, ACS 5-year estimates",
fill = "Median Income")
#plotting med rent
ggplot()+
geom_sf(data = allTracts.group, aes(fill = q5(MedRent)), color="transparent")+
scale_fill_manual(values = palette5,
labels = qBr(allTracts.group, "MedRent"),
name = "Median Rent\n(Quintile Breaks)") + mapTheme() +
facet_wrap(~year)+
geom_sf(data = allTracts.group %>%
filter(TOD == "TOD") %>%
st_union(),
color = "red",
fill = "transparent")+
labs(
title = "Median Rent in 2020 adjusted Dollars, 2016-2020",
subtitle = "",
caption = "Figure Number, Data: US Census Bureau, ACS 5-year estimates",
fill = "Median Rent")
# Load Libraries
library(tidyverse)
library(tidycensus)
library(sf)
library(kableExtra)
library(tidyr)
library(ggplot2)
library(viridis)
library(prettydoc)
options(scipen=999)
options(tigris_class = "sf")
#these are functions developed for this class, so it takes you especially to the book to get those
source("https://raw.githubusercontent.com/urbanSpatial/Public-Policy-Analytics-Landing/master/functions.r")
palette5 <- c("#fde725","#5ec962","#21918c","#3b528b","#440154")
census_api_key('bf2d507651b5a621dbadd44533fb4f3deaab26bf', overwrite = TRUE)
dir.create("output")
#creating a buffer
MBTABuffers <-
rbind(
st_buffer(clippedMBTA, 2640) %>%
mutate(Legend = "Buffer") %>%
dplyr::select(Legend),
st_union(st_buffer(clippedMBTA, 2640)) %>% #the number at the end is in feet, because our CRS is in feet
st_sf() %>%
mutate(Legend = "Unioned Buffer")) #all st functions will be spatial related stuff
ggplot() +
geom_sf(data=MBTABuffers) +
geom_sf(data=clippedMBTA, show.legend = "point") +
facet_wrap(~Legend) +
labs(caption = "Figure 1.2") +
mapTheme()
#just the buffers
buffer <- filter(MBTABuffers, Legend=="Unioned Buffer")
#plotting BusArtSciences
ggplot()+
geom_sf(data = allTracts.group, aes(fill = q5(BusArtsScience)),color="transparent")+
scale_fill_manual(values = palette5,
labels = qBr(allTracts.group, "TotalPop"),
name = "Number of Residents\n(Quintile Breaks)") + mapTheme() +
facet_wrap(~year)+
geom_sf(data = allTracts.group %>%
filter(TOD == "TOD") %>%
st_union(),
color = "red",
fill = "transparent")+
labs(
title = "People Employed in the Business, Arts or Sciences Sector, 2016-2020",
subtitle = "",
caption = "Figure Number, Data: US Census Bureau, ACS 5-year estimates",
fill = "Population")
View(allTracts.group)
allTracts.Summary <-
st_drop_geometry(allTracts.group) %>% #best to go non spatil here because we're just making a table
group_by(year, TOD) %>%
summarize(Population = mean(TotalPop, na.rm = T),
Rent = mean(MedRent, na.rm = T),
Income = mean(MedInc, na.rm = T),
Bus_Art_Sciences = mean(BusArtsScience, na.rm = T),
Percent_Inc_on_Rent = mean(IncSpentOnRentPCt, na.rm = T))
kable(allTracts.Summary) %>%
kable_styling() %>%
footnote(general_title = "\n",
general = "Table 2.2")
# tables
allTracts.Summary <-
st_drop_geometry(allTracts.group) %>% #best to go non spatil here because we're just making a table
group_by(year, TOD) %>%
summarize(Population = mean(TotalPop, na.rm = T),
Rent = mean(MedRent, na.rm = T),
Income = mean(MedInc, na.rm = T),
Bus_Art_Sciences = mean(BusArtsScience, na.rm = T),
Percent_Inc_on_Rent = mean(IncSpentOnRentPCt, na.rm = T))
allTracts.Summary %>%
unite(year.TOD, year, TOD, sep = ": ", remove = T) %>%
gather(Variable, Value, -year.TOD) %>%
mutate(Value = round(Value, 2)) %>%
spread(year.TOD, Value) %>%
kable() %>%
kable_styling() %>%
footnote(general_title = "\n",
general = "Table 2.3")
#grouped bar graphs
allTracts.Summary %>%
gather(Variable, Value, -year, -TOD) %>%
geom_bar(stat = "identity", position = "dodge") +
facet_wrap(~Variable, scales = "free", ncol=5) +
scale_fill_manual(values = c("#bae4bc", "#0868ac")) +
labs(title = "Indicator differences across time and space") +
plotTheme() + theme(legend.position="bottom")
View(allTracts.Summary)
#grouped bar graphs
allTracts.Summary %>%
gather(Variable, Value, -year, -TOD) %>%
geom_bar(stat = "identity", position = "dodge") +
facet_wrap(~Variable, scales = "free", ncol=5) +
scale_fill_manual(values = c("#bae4bc", "#0868ac")) +
labs(title = "Indicator differences across time and space") +
plotTheme() + theme(legend.position="bottom")
#grouped bar graphs
allTracts.Summary %>%
gather(Variable, Value, -year, -TOD) %>%
ggplot(aes(year, Value, fill = TOD)) +
geom_bar(stat = "identity", position = "dodge") +
facet_wrap(~Variable, scales = "free", ncol=5) +
scale_fill_manual(values = c("#bae4bc", "#0868ac")) +
labs(title = "Indicator differences across time and space") +
plotTheme() + theme(legend.position="bottom")
#grouped bar graphs
allTracts.Summary %>%
gather(Variable, Value, -year, -TOD) %>%
ggplot(aes(year, Value, fill = TOD)) +
geom_bar(stat = "identity", position = "dodge") +
facet_wrap(~Variable, scales = "free", ncol=5) +
scale_fill_manual(values = c("#bae4bc", "#0868ac")) +
labs(title = "Indicator differences across time and space") +
+ theme(strip.text = element_text(size = 10))+
plotTheme() + theme(legend.position="bottom")
#grouped bar graphs
allTracts.Summary %>%
gather(Variable, Value, -year, -TOD) %>%
ggplot(aes(year, Value, fill = TOD)) +
geom_bar(stat = "identity", position = "dodge") +
facet_wrap(~Variable, scales = "free", ncol=5) +
scale_fill_manual(values = c("#bae4bc", "#0868ac")) +
labs(title = "Indicator differences across time and space") +
theme(strip.text = element_text(size = 10))+
plotTheme() + theme(legend.position="bottom")
#grouped bar graphs
allTracts.Summary %>%
gather(Variable, Value, -year, -TOD) %>%
ggplot(aes(year, Value, fill = TOD)) +
geom_bar(stat = "identity", position = "dodge") +
facet_wrap(~Variable, scales = "free", ncol=5) +
scale_fill_manual(values = c("#bae4bc", "#0868ac")) +
labs(title = "Indicator differences across time and space") +
theme(strip.text = element_text(size = 1))+
plotTheme() + theme(legend.position="bottom")
#grouped bar graphs
allTracts.Summary %>%
gather(Variable, Value, -year, -TOD) %>%
ggplot(aes(year, Value, fill = TOD)) +
geom_bar(stat = "identity", position = "dodge") +
facet_wrap(~Variable, scales = "free", ncol=5) +
scale_fill_manual(values = c("#bae4bc", "#0868ac")) +
labs(title = "Indicator differences across time and space") +
theme(strip.text = element_text(size = 0))+
plotTheme() + theme(legend.position="bottom")
#grouped bar graphs
allTracts.Summary %>%
gather(Variable, Value, -year, -TOD) %>%
ggplot(aes(year, Value, fill = TOD)) +
geom_bar(stat = "identity", position = "dodge") +
facet_wrap(~Variable, scales = "free", ncol=5) +
scale_fill_manual(values = c("#bae4bc", "#0868ac")) +
labs(title = "Indicator differences across time and space") +
theme(strip.text = element_text(size = 0))+
theme(legend.position="bottom")
#grouped bar graphs
allTracts.Summary %>%
gather(Variable, Value, -year, -TOD) %>%
ggplot(aes(year, Value, fill = TOD)) +
geom_bar(stat = "identity", position = "dodge") +
facet_wrap(~Variable, scales = "free", ncol=5) +
scale_fill_manual(values = c("#bae4bc", "#0868ac")) +
labs(title = "Indicator differences across time and space") +
theme(strip.text = element_text(size = 10))+
theme(legend.position="bottom")
#grouped bar graphs
allTracts.Summary %>%
gather(Variable, Value, -year, -TOD) %>%
ggplot(aes(year, Value, fill = TOD)) +
geom_bar(stat = "identity", position = "dodge") +
facet_wrap(~Variable, scales = "free", ncol=5) +
scale_fill_manual(values = c("#bae4bc", "#0868ac")) +
labs(title = "Indicator differences across time and space") +
theme(strip.text = element_text(size = 7))+
theme(legend.position="bottom")
#grouped bar graphs
allTracts.Summary %>%
gather(Variable, Value, -year, -TOD) %>%
ggplot(aes(year, Value, fill = TOD)) +
geom_bar(stat = "identity", position = "dodge") +
facet_wrap(~Variable, scales = "free", ncol=5) +
scale_fill_manual(values = c("#bae4bc", "#0868ac")) +
labs(title = "Indicator differences across time and space") +
theme(strip.text = element_text(size = 8))+
theme(legend.position="bottom")
#grouped bar graphs
allTracts.Summary %>%
gather(Variable, Value, -year, -TOD) %>%
ggplot(aes(year, Value, fill = TOD)) +
geom_bar(stat = "identity", position = "dodge") +
facet_wrap(~Variable, scales = "free", ncol=5) +
scale_fill_manual(values = c("#bae4bc", "#0868ac")) +
labs(title = "Indicator differences across time and space") +
theme(strip.text = element_text(size = 7.5))+
theme(legend.position="bottom")
#grouped bar graphs
allTracts.Summary %>%
gather(Variable, Value, -year, -TOD) %>%
ggplot(aes(year, Value, fill = TOD)) +
geom_bar(stat = "identity", position = "dodge") +
facet_wrap(~Variable, scales = "free", ncol=5) +
scale_fill_manual(values = c("#bae4bc", "#0868ac")) +
labs(title = "Indicator differences across time and space") +
theme(strip.text = element_text(size = 7))+
theme(legend.position="bottom")
View(plotTheme)
#plotting total pop
ggplot()+
geom_sf(data = allTracts.group, aes(fill = q5(TotalPop)), color="transparent")+
scale_fill_manual(values = palette5,
labels = qBr(allTracts.group, "TotalPop"),
name = "Popluation\n(Quintile Breaks)") + mapTheme() +
facet_wrap(~year)+
geom_sf(data = allTracts.group %>%
filter(TOD == "TOD") %>%
st_union(),
color = "red",
fill = "transparent")+
labs(
title = "Total Population, 2016-2020",
subtitle = "",
caption = "Figure Number, Data: US Census Bureau, ACS 5-year estimates",
fill = "Total Population")
View(allTracts.group)
#plotting pct income spent on rent
ggplot()+
geom_sf(data = allTracts.group, aes(fill = q5(IncSpentOnRentPCt)), color="transparent")+
scale_fill_manual(values = palette5,
labels = qBr(allTracts.group, "IncSpentOnRentPCt"),
name = "Percentage of Income Spent on Rent\n(Quintile Breaks)") + mapTheme() +
facet_wrap(~year)+
geom_sf(data = allTracts.group %>%
filter(TOD == "TOD") %>%
st_union(),
color = "red",
fill = "transparent")+
labs(
title = "Percentage of Income Spent on Rent, 2016-2020",
subtitle = "",
caption = "Figure Number, Data: US Census Bureau, ACS 5-year estimates",
fill = "Median Rent")
#plotting pct income spent on rent
ggplot()+
geom_sf(data = allTracts.group, aes(fill = q5(IncSpentOnRentPCt)), color="transparent")+
scale_fill_manual(values = palette5,
labels = qBr(allTracts.group, "IncSpentOnRentPCt"),
name = "PCT_of_Inc_On_Rent\n(Quintile Breaks)") + mapTheme() +
facet_wrap(~year)+
geom_sf(data = allTracts.group %>%
filter(TOD == "TOD") %>%
st_union(),
color = "red",
fill = "transparent")+
labs(
title = "Percentage of Income Spent on Rent, 2016-2020",
subtitle = "",
caption = "Figure Number, Data: US Census Bureau, ACS 5-year estimates",
fill = "Median Rent")
